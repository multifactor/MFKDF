{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://mfkdf.com/schema/v2.0.0/policy.json",
  "type": "object",
  "title": "Multi-Factor Derived Key Policy Schema",
  "description": "A multi-factor derived key policy defines the factors and methods used to derive a key via multi-factor key derivation.",
  "required": ["threshold", "salt", "factors", "$id", "$schema", "key"],
  "properties": {
    "$schema": {
      "type": "string",
      "title": "Key Schema",
      "description": "Link to the version of the schema that can validate the key policy."
    },
    "$id": {
      "type": "string",
      "title": "Key ID",
      "description": "String which uniquely identifies this key."
    },
    "threshold": {
      "type": "integer",
      "title": "Factor Threshold",
      "description": "The number of correct factors needed to derive this key."
    },
    "salt": {
      "type": "string",
      "title": "KDF Salt",
      "description": "Base-64 encoded salt value used as additional input to the KDF."
    },
    "hmac": {
      "type": "string",
      "title": "Policy Signature",
      "description": "Base-64 encoded HMAC value used to protect policy integrity."
    },
    "key": {
      "type": "string",
      "title": "Encrypted Key",
      "description": "Base-64 encoded AES-encrypted final key; used to enable key strengthening."
    },
    "time": {
      "type": "integer",
      "title": "Additional Argon2 Time Cost",
      "description": "Additional rounds of argon2 time cost to add, beyond OWASP minimums."
    },
    "memory": {
      "type": "integer",
      "title": "Additional Argon2 Memory Cost",
      "description": "Additional argon2 memory cost to add (in KiB), beyond OWASP minimums."
    },
    "factors": {
      "type": "array",
      "title": "Factors",
      "description": "Factors which can be used to derive this key.",
      "items": {
        "type": "object",
        "title": "Factor",
        "description": "Factor which can be used to derive this key.",
        "required": ["id", "type", "pad", "salt", "params"],
        "properties": {
          "id": {
            "type": "string",
            "title": "Factor ID",
            "description": "String which uniquely identifies this factor."
          },
          "type": {
            "type": "string",
            "title": "Factor Type",
            "description": "Name of the factor material function to use."
          },
          "pad": {
            "type": "string",
            "title": "Factor Pad",
            "description": "Base-64 encoded intermediate value to combine with factor material."
          },
          "salt": {
            "type": "string",
            "title": "Factor Salt",
            "description": "Base-64 encoded intermediate value to combine with factor material."
          },
          "secret": {
            "type": "string",
            "title": "Factor Secret",
            "description": "Base-64 encrypted factor secret value used to reconstitute key."
          },
          "hint": {
            "type": "string",
            "title": "Factor Hint",
            "description": "Optional hash hint to help user remember this factor; reveals some bits of entropy."
          },
          "params": {
            "type": "object",
            "title": "Factor Parameters",
            "description": "Parameters required by chosen factor material function.",
            "required": []
          }
        }
      }
    }
  }
}
